@page "{editId?}"
@model SuperMarket.Pages.AdminDashboardModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container my-5">
    <h1 class="mb-4">@ViewData["Title"]</h1>

    <!-- Display validation errors -->
    <div asp-validation-summary="All" class="alert alert-danger"></div>

<h2 class="mb-3">@((Model.NewProduct != null && Convert.ToInt32(Model.NewProduct.ProductID) != 0) ? "Edit Product" : "Add New Product")</h2>

    <form method="post" asp-page-handler="@(Model.NewProduct != null && Convert.ToInt32(Model.NewProduct.ProductID) != 0 ? "Edit" : "Add")" class="row g-3">
        <div class="col-md-6">
            <label asp-for="NewProduct.ProductID" class="form-label"></label>
            <input asp-for="NewProduct.ProductID" 
                class="form-control" 
                readonly="@Model.IsEditing" />
            <span asp-validation-for="NewProduct.ProductID" class="text-danger"></span>
        </div>



        <div class="col-md-6">
            <label asp-for="NewProduct.ProductName" class="form-label"></label>
            <input asp-for="NewProduct.ProductName" class="form-control" />
            <span asp-validation-for="NewProduct.ProductName" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="NewProduct.Price" class="form-label"></label>
            <input asp-for="NewProduct.Price" class="form-control" />
            <span asp-validation-for="NewProduct.Price" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="NewProduct.Category" class="form-label"></label>
            <input asp-for="NewProduct.Category" class="form-control" />
            <span asp-validation-for="NewProduct.Category" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="NewProduct.InventoryID" class="form-label"></label>
            <input asp-for="NewProduct.InventoryID" class="form-control" />
            <span asp-validation-for="NewProduct.InventoryID" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="NewProduct.image" class="form-label"></label>
            <input asp-for="NewProduct.image" class="form-control" />
            <span asp-validation-for="NewProduct.image" class="text-danger"></span>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary">
                @((Model.NewProduct != null && Convert.ToInt32(Model.NewProduct.ProductID) != 0) ? "Update Product" : "Add Product")
            </button>
        </div>
    </form>

    @if (Model.NewProduct != null && Convert.ToInt32(Model.NewProduct.ProductID) != 0)
    {
        <p class="mt-3">
            <a asp-page="./AdminDashboard" class="btn btn-secondary">Cancel Editing</a>
        </p>
    }

    <h2 class="mt-5">Product List</h2>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>@Html.DisplayNameFor(m => m.Products.First().ProductID)</th>
                <th>@Html.DisplayNameFor(m => m.Products.First().ProductName)</th>
                <th>@Html.DisplayNameFor(m => m.Products.First().Price)</th>
                <th>@Html.DisplayNameFor(m => m.Products.First().Category)</th>
                <th>@Html.DisplayNameFor(m => m.Products.First().InventoryID)</th>
                <th>@Html.DisplayNameFor(m => m.Products.First().image)</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model.Products)
            {
                <tr>
                    <td>@product.ProductID</td>
                    <td>@product.ProductName</td>
                    <td>@product.Price.ToString("C")</td>
                    <td>@product.Category</td>
                    <td>@product.InventoryID</td>
                    <td><img src="@product.image" alt="Product Image" class="img-fluid" style="max-height: 50px;" /></td>
                    <td>
                        <a asp-page="./AdminDashboard" asp-route-editId="@product.ProductID" class="btn btn-sm btn-warning">Edit</a>
                        <form method="post" asp-page-handler="Delete" class="d-inline">
                            <input type="hidden" name="productId" value="@product.ProductID" />
                            <button type="submit" class="btn btn-sm btn-danger" 
                                    onclick="return confirm('Are you sure you want to delete this product?');">Delete</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
